@model resourceEdge.Domain.Entities.reportmanagerViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using (Html.BeginForm())
{

    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>LeaveManagementViewModel</h4>
        <hr />

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
       
        <div class="form-group">
            @Html.Label("Business Unit", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(x => x.BunitId, (SelectList)ViewBag.businessUnits, htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.BunitId, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.Label("Employee", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <select id="userId" name="userId" class="form-control"><option value="">Select Employee</option></select>
                @Html.ValidationMessageFor(model => model.userId, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Create" class="btn btn-default" />
            </div>
        </div>
    </div>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
<script>
    function GetEligibleReportManager(id) {
        $.ajax({
            type: 'GET',
            url: 'http://localhost:58124/api/Settings/GetEligibleReportManager/' + id,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log('in the GetEmployeeByBusinessUnit  method');
                console.log(data);
                $('#userId').empty();
                if (data != '') {
                    $('#userId').append('<option value="">' + '--Select Employee--' + '</option>');
                    $.each(data, function (index, data) {
                        $('#userId').append('<option value="' + data.userId + '">' + data.empEmail + '</option>');
                    })
                } else {

                    $('#userId').append('<option value="">' + 'No Employee For this Unit yet' + '</option>')
                }
            },
            failure: function () {
                var message = {
                    message: "Failed to load data... Try again later"
                };
                $('#userId').append('<option value="">' + message.message + '</option>')
            }
        })
    };



    $('#BunitId').bind('change', function () {
        GetEligibleReportManager($(this).val());
    });

    </script>
}


